<!doctype html>
<html lang="en" class="h-full antialiased">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Begin Bridgetown SEO tag v7.0.1 -->
<title>Sound to Script: Using OpenAI’s Whisper Model and Whisper.cpp | Mario Alberto Chávez - Ruby on Rails, AI Tools &amp; former CTO</title>
<meta property="og:title" content="Sound to Script: Using OpenAI’s Whisper Model and Whisper.cpp" />
<meta name="author" content="Mario Alberto Chávez" />
<meta property="og:locale" content="en" />
<meta name="description" content="AI offers a different set of inputs and outputs for inferences. One of the many inference models is Automatic Speech Recognition (ASR). Using OpenAI’s Whiper model makes transcribing pre-recorded or live audio possible." />
<meta property="og:description" content="AI offers a different set of inputs and outputs for inferences. One of the many inference models is Automatic Speech Recognition (ASR). Using OpenAI’s Whiper model makes transcribing pre-recorded or live audio possible." />
<link rel="canonical" href="https://mariochavez.io/desarrollo/2023/12/10/sound-to-script-openia-whisper/" />
<meta property="og:url" content="https://mariochavez.io/desarrollo/2023/12/10/sound-to-script-openia-whisper/" />
<meta property="og:site_name" content="Mario Alberto Chávez - Ruby on Rails, AI Tools &amp; former CTO" />
<meta property="og:image" content="https://mariochavez.io/images/whisper/sound.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-12-10T00:00:00-06:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://mariochavez.io/images/whisper/sound.jpg" />
<meta property="twitter:title" content="Sound to Script: Using OpenAI’s Whisper Model and Whisper.cpp" />
<meta name="twitter:site" content="@mario_chavez" />
<meta name="twitter:creator" content="@Mario Alberto Chávez" />
<!-- End Bridgetown SEO tag -->


<link type="application/atom+xml" rel="alternate" href="https://mariochavez.io/feed.xml" title="Mario Alberto Chávez - Ruby on Rails, AI Tools & former CTO" />

<meta property="og:type" content="article">
<meta property="og:site_name" content="Mario Alberto Chávez - Software Development">
<meta name="twitter:card" content="summary_large_image">

<meta name="robots" content="index, follow">
<meta name="revisit-after" content="7 days">

<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<link rel="stylesheet" href="/assets/index.C2JFVGXA.css" />
<script src="/assets/index.OQDTOKYE.js" defer></script>


<script type="application/javascript">
  (function() {
    try {
      const theme = localStorage.getItem('theme');
      if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    } catch (e) {
      // Fail silently
    }
  })();
</script>

<script type="application/ld+json">
  {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": "https://mariochavez.io/#website",
      "url": "https://mariochavez.io/",
      "name": "Mario Alberto Chávez",
      "description": "Ruby on Rails architect and AI toolmaker from Colima, México. Creator of Rails MCP Server, former fintech CTO, and author of Aprendiendo Ruby on Rails. Exploring the convergence of Rails and AI.",
      "publisher": {
        "@type": "Person",
        "@id": "https://mariochavez.io/#person",
        "name": "Mario Alberto Chávez"
      },
    },
    {
      "@type": "CollectionPage",
      "@id": "https://mariochavez.io/#webpage",
      "url": "https://mariochavez.io/",
      "name": "Inicio | Mario Alberto Chávez",
      "isPartOf": {
        "@id": "https://mariochavez.io/#website"
      },
      "about": {
        "@id": "https://mariochavez.io/#person"
      },
      "description": "Ruby on Rails architect and AI toolmaker from Colima, México. Creator of Rails MCP Server, former fintech CTO, and author of Aprendiendo Ruby on Rails. Exploring the convergence of Rails and AI.",
      "breadcrumb": {
        "@id": "https://mariochavez.io/#breadcrumb"
      },
    },
    {
      "@type": "BreadcrumbList",
      "@id": "https://mariochavez.io/#breadcrumb",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Inicio"
        }
      ]
    },
    {
      "@type": "Person",
      "@id": "https://mariochavez.io/#person",
      "name": "Mario Alberto Chávez",
      "image": {
        "@type": "ImageObject",
        "@id": "https://mariochavez.io/#personlogo",
        "inLanguage": "es-MX",
        "url": "https://mariochavez.io/images/mario_chavez.svg",
        "contentUrl": "https://mariochavez.io/images/mario_chavez.svg",
        "caption": "Mario Alberto Chávez"
      },
      "description": "I'm Mario Alberto, a software engineer and entrepreneur based in Colima, México. I'm the creator of Rails MCP Server and former CTO/co-founder of Aoorora, where I architected a core banking platform in Ruby on Rails that enabled lending startups to build on modern, secure infrastructure. I spend my time at the intersection of Ruby on Rails and AI—building tools that help developers work smarter. When I'm not writing code, I'm documenting territory, popular culture, and memory through photography.",
      "sameAs": [
        "https://github.com/mariochavez",
        "https://x.com/mario_chavez",
        "https://linkedin.com/in/mariochavez",
        "https://instagram.com/mario_chavez"
      ]
    }
  ]
}

</script>

  </head>

  <body class="flex h-full flex-col bg-zinc-50 font-manrope dark:bg-black">
    <!-- Outer Frame for the "Card" look on large screens -->
    <div class="fixed inset-0 flex justify-center sm:px-8">
      <div class="flex w-full max-w-7xl lg:px-8">
        <div
          class="
            w-full bg-white ring-1 ring-zinc-100 dark:bg-zinc-900 dark:ring-zinc-300/20
          "
        ></div>
      </div>
    </div>

    <div class="relative flex w-full flex-col">
      <!-- Header / Navigation -->
<header
  data-controller="menu"
  data-menu-open-value=false
  class="pointer-events-none relative z-50 flex flex-none flex-col"
>
  <div class="top-0 z-10 h-16 pt-6">
    <div class="sm:px-8 w-full max-w-7xl mx-auto lg:px-8">
      <div class="relative px-4 sm:px-8 lg:px-12">
        <div class="mx-auto max-w-2xl lg:max-w-5xl">
          <div class="relative flex gap-4">
            <!-- Logo / Avatar -->
            <div class="flex flex-1 pointer-events-auto">
              <a
                href="/"
                class="
                  h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1
                  ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:ring-white/10
                "
              >
                <img
                  src="/images/mario.jpg"
                  alt="Mario Alberto Chávez"
                  class="
                    h-9 w-9 rounded-full bg-zinc-100 object-cover
                    dark:bg-zinc-800
                  "
                >
              </a>
            </div>

            <!-- Desktop Nav -->
            <div class="hidden md:flex flex-1 justify-center pointer-events-auto">
              <nav
                class="
                  flex rounded-full bg-white/90 px-3 text-sm font-medium text-zinc-800 shadow-lg
                  shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90
                  dark:text-zinc-200 dark:ring-white/10
                "
              >
               
                  <a
                      href="/about"
                    class="
                      relative block px-3 py-2 transition hover:text-emerald-500
                      dark:hover:text-emerald-400
                    "
                  >
                  About
                  </a>
                
                  <a
                      href="/articles"
                    class="
                      relative block px-3 py-2 transition hover:text-emerald-500
                      dark:hover:text-emerald-400
                    "
                  >
                  Articles
                  </a>
                
                  <a
                      href="/projects"
                    class="
                      relative block px-3 py-2 transition hover:text-emerald-500
                      dark:hover:text-emerald-400
                    "
                  >
                  Projects
                  </a>
                
              </nav>
            </div>

            <!-- Mobile Menu Button & Theme Toggle -->
            <div class="flex flex-1 justify-end gap-4 pointer-events-auto">
              <!-- Mobile Menu Button -->
              <div class="pointer-events-auto md:hidden">
                <button
                  data-action="menu#toggle"
                  class="
                    group flex items-center rounded-full bg-white/90 px-4 py-2 text-sm font-medium
                    text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur
                    dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10
                    dark:hover:ring-white/20
                  "
                >
                  Menu
                  <i
                    class="
                      ml-3 h-auto w-2 [&_svg]:size-3 stroke-zinc-500 group-hover:stroke-zinc-700
                      dark:group-hover:stroke-zinc-400
                    "
                    
                  ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
</i>
                </button>
              </div>

              <div 
                data-menu-target="overlay"
                data-action="click->menu#toggle"
                class="
                  data-[open=false]:hidden fixed inset-0 z-50 bg-zinc-800/40 backdrop-blur-xs duration-150 
                  opacity-100 data-[open=false]:opacity-0 ease-in dark:bg-black/80
                " 
                aria-hidden="true" 
                data-open="false">
              </div>

              <!-- Theme Toggle (Visual Only) -->
              <button
                  data-controller="theme"
                  data-theme-dark-value
                  data-action="theme#toggle"
                  class="
                    group rounded-full bg-white/90 px-3 py-2 shadow-lg ring-1 shadow-zinc-800/5 ring-zinc-900/5 
                    backdrop-blur-sm transition dark:bg-zinc-800/90 dark:ring-white/10 dark:hover:ring-white/20
                  "
              >
                <i
                  data-theme-target="light"
                  class="
                    [&_svg]:size-5 text-zinc-500 transition group-hover:fill-zinc-200
                    group-hover:text-zinc-700 dark:hidden
                  "
                  ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
</i>

                <i
                  data-theme-target="dark"
                  class="
                    hidden [&_svg]:size-5 text-emerald-700 transition dark:block
                    dark:group-hover:text-emerald-400
                  "
                  ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"/></svg>
</i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Dropdown -->
  <div
    data-menu-target="menu"
    data-open="false"
    class="
      data-[open=false]:hidden opacity-100 data-[open=false]:opacity-0 data-[open=false]:scale-95 
      fixed inset-x-0 top-0 z-50 origin-top rounded-b-2xl bg-zinc-50 px-6 pb-6 pt-24
      shadow-2xl shadow-zinc-900/20 ring-1 ring-zinc-900/5 dark:bg-zinc-900 transition-all ease-out
      dark:ring-zinc-800 pointer-events-auto md:hidden duration-150
    "
  >
    <div class="flex flex-col space-y-4">
      <div class="flex flex-row-reverse items-center justify-between">
        <button 
           data-action="menu#toggle"
           aria-label="Close menu" 
           class="-m-1 p-1 [&_svg]:size-6 text-zinc-500 dark:text-zinc-400" 
           type="button">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="m17.25 6.75-10.5 10.5M6.75 6.75l10.5 10.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
 
        </button>
        <h2 class="text-sm font-medium text-zinc-600 dark:text-zinc-400">Navigation</h2>
      </div>
      
        <a
            href="/about"
          class="block text-base font-semibold text-zinc-800 dark:text-zinc-100"
        >
          About
        </a>
      
        <a
            href="/articles"
          class="block text-base font-semibold text-zinc-800 dark:text-zinc-100"
        >
          Articles
        </a>
      
        <a
            href="/projects"
          class="block text-base font-semibold text-zinc-800 dark:text-zinc-100"
        >
          Projects
        </a>
      
    </div>
  </div>
</header>


      <main class="flex-auto pointer-events-auto">
  <div class="mt-16 sm:px-8 sm:mt-32">
    <div class="mx-auto w-full max-w-7xl lg:px-8">
      <div class="relative px-4 sm:px-8 lg:px-12">
        <div class="mx-auto max-w-2xl lg:max-w-5xl">
          <div class="xl:relative">
            <div class="mx-auto max-w-2xl">
              <!-- Back Button -->
              <a
                href="/articles"
                aria-label="Go back to articles"
                class="
                  group mb-8 flex h-10 w-10 items-center justify-center rounded-full bg-white
                  shadow-md shadow-zinc-800/5 ring-1 ring-zinc-900/5 transition dark:border
                  dark:border-zinc-700/50 dark:bg-zinc-800 dark:ring-0 dark:ring-white/10
                  dark:hover:border-zinc-700 dark:hover:ring-white/20 lg:absolute lg:-left-5
                  lg:-mt-2 lg:mb-0 xl:-top-1.5 xl:left-0 xl:mt-0
                "
              >
                <i
                  class="
                    [&_svg]:size-4 text-zinc-500 transition group-hover:text-zinc-700
                    dark:text-zinc-400 dark:group-hover:text-zinc-300
                  "
                  ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
</i>
              </a>

              <article>
                <header class="flex flex-col">
                  <time
                      datetime="2023-12-10 00:00:00 -0600"
                    class="
                      order-first flex items-center text-base text-zinc-400
                      dark:text-zinc-500
                    "
                  >
                    <span class="h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span>
                    <span class="ml-3">December 10, 2023</span>
                  </time>

                  <h1
                    class="
                      mt-6 text-4xl font-bold tracking-tight text-emerald-700 dark:text-emerald-100
                      sm:text-5xl
                    "
                  >
                  Sound to Script: Using OpenAI's Whisper Model and Whisper.cpp
                  </h1>

                  <h3 class="text-2xl text-zinc-600 font-light tracking-tight mt-6 dark:text-zinc-100 sm:text-3xl">AI offers a different set of inputs and outputs for inferences. One of the many inference models is Automatic Speech Recognition (ASR). Using OpenAI's Whiper model makes transcribing pre-recorded or live audio possible.</h3>
                </header>

                <!-- Article Content -->
                <div class="mt-8 prose prose-zinc dark:prose-invert">
                  <p>AI offers a different set of inputs and outputs for inferences. One of the many inference models is Automatic Speech Recognition (ASR). Using OpenAI’s Whiper model makes transcribing pre-recorded or live audio possible.</p>

<p><a href="https://github.com/ggerganov/whisper.cpp">Whisper.cpp</a> implements OpenAI’s Whisper model, which allows you to run this model on your machine. It could be done running your CPU, Apple’s Core ML from M processors, or using a dedicated GPU unit. You can run the smaller or larger Whisper model; Whisper.cpp also supports running quantized models, which require less memory and disk space using the <a href="https://github.com/ggerganov/ggml">GGML library</a>.</p>

<p>So, let’s see how to use Whisper.cpp to process a video to get subtitle SRT format.</p>

<p>First, you need to clone the Whisper.cpp repository.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone <span class="o">[</span>https://github.com/ggerganov/whisper.cpp]<span class="o">(</span>https://github.com/ggerganov/whisper.cpp<span class="o">)</span>
</code></pre></div></div>

<p>If you are running Whisper.cpp from your CPU, change to the code folder and run the make command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make
</code></pre></div></div>

<p>Then download a Whiper model in ggml format:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash ./models/download-ggml-model.sh base.en
</code></pre></div></div>

<p>You can find available models here: <a href="https://huggingface.co/ggerganov/whisper.cpp">https://huggingface.co/ggerganov/whisper.cpp</a></p>

<p>With the model in place, run the following command to test it with a sample audio in the repository.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./main <span class="nt">-f</span> samples/jfk.wav
</code></pre></div></div>

<p>You should see the model being loaded; at the end, it displays the inferred text from the audio.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>main: processing <span class="s1">'samples/jfk.wav'</span> <span class="o">(</span>176000 samples, 11.0 sec<span class="o">)</span>, 4 threads, 1 processors, 5 beams + best of 5, lang <span class="o">=</span> en, task <span class="o">=</span> transcribe, timestamps <span class="o">=</span> 1 ...
<span class="o">[</span>00:00:00.000 <span class="nt">--</span><span class="o">&gt;</span> 00:00:11.000]   And so my fellow Americans, ask not what your country can <span class="k">do for </span>you, ask what you can <span class="k">do for </span>your country.
</code></pre></div></div>

<p>Now, I’ll focus on getting Whisper.cpp to work with Apple’s silicon processor to get better performance at inference.</p>

<p>You need Python installed to prepare Whisper models for running with Apple’s Core ML. The best way to set up Python is to install it via <a href="https://docs.conda.io/projects/miniconda/en/latest/">Miniconda</a> and create an environment for Whisper.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda create <span class="nt">-n</span> py310-whisper <span class="nv">python</span><span class="o">=</span>3.10 <span class="nt">-y</span>
conda activate py310-whisper
</code></pre></div></div>

<p>With Python ready and activated, install the following dependencies for Core ML.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>ane_transformers
pip <span class="nb">install </span>openai-whisper
pip <span class="nb">install </span>coremltools
</code></pre></div></div>

<p>Next, generate a Core ML model off the downloaded base.en Whisper model. If you downloaded a different model, update the command to reflect that change.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./models/generate-coreml-model.sh base.en
</code></pre></div></div>

<p>Finally, you need to compile Whisper.cpp with Core ML support.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make clean
<span class="nv">WHISPER_COREML</span><span class="o">=</span>1 make <span class="nt">-j</span>
</code></pre></div></div>

<p>Running the Core ML model with Whisper.cpp Core ML support produces faster inference.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./main <span class="nt">-m</span> models/ggml-base.en.bin <span class="nt">-f</span> samples/jfk.wav
</code></pre></div></div>

<p>With these tools ready, you can move to a different scenario where the audio needs to be extracted from a video, passed to Whisper.cpp, and produced the subtitle file in SRT format.</p>

<p>To extract audio from a video, <a href="https://ffmpeg.org">ffmpeg</a> is the best tool for this job. Whisper.cpp needs audio in 16-bit format.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ffmpeg <span class="nt">-i</span> video.mp4  <span class="nt">-ar</span> 16000 <span class="nt">-ac</span> 1 <span class="nt">-c</span>:a pcm_s16le video.wav
</code></pre></div></div>

<p>The output is a WAV audio file that you can use to produce a transcription into a JSON file.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./main -m models/ggml-base.en.bin -f video.wav  -oj -ojf video
....
    
	"params": {
            "model": "models/ggml-medium.en-q5_0.bin",
            "language": "en",
            "translate": false
    },
    "result": {
            "language": "en"
    },
    "transcription": [
            {
                    "timestamps": {
                            "from": "00:00:00,720",
                            "to": "00:00:08,880"
                    },
                    "offsets": {
                            "from": 720,
                            "to": 8880
                    },
                    "text": " Hi, everyone. Would you let people in why? Okay. Yes. My name is Selma. For those of you that don't",
                    "tokens": [
                            {
                                    "text": " Hi",
                                    "timestamps": {
                                            "from": "00:00:00,000",
                                            "to": "00:00:00,240"
                                    },
                                    "offsets": {
                                            "from": 0,
                                            "to": 240
                                    },
                                    "id": 15902,
                                    "p": 0.882259
                            },
                            {
                                    "text": ",",
                                    "timestamps": {
                                            "from": "00:00:00,240",
                                            "to": "00:00:00,470"
                                    },
                                    "offsets": {
                                            "from": 240,
                                            "to": 470
                                    },
....
</code></pre></div></div>

<p>This JSON file can be transformed to meet our needs. In our case, we want to produce an SRT format for video player subtitles. This last part is done with a Ruby script.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>json_data <span class="o">=</span> JSON.parse<span class="o">(</span>File.read<span class="o">(</span>json_file_path<span class="o">))</span>

transcription <span class="o">=</span> json_data[<span class="s1">'transcription'</span><span class="o">]</span>
srt_content <span class="o">=</span> <span class="s2">""</span>

transcription.each_with_index <span class="k">do</span> |entry, index|
  from_time <span class="o">=</span> entry[<span class="s1">'timestamps'</span><span class="o">][</span><span class="s1">'from'</span><span class="o">]</span>
  to_time <span class="o">=</span> entry[<span class="s1">'timestamps'</span><span class="o">][</span><span class="s1">'to'</span><span class="o">]</span>
  text <span class="o">=</span> entry[<span class="s1">'text'</span><span class="o">]</span>

  srt_content +<span class="o">=</span> <span class="s2">"#{index + 1}</span><span class="se">\\</span><span class="s2">n"</span>
  srt_content +<span class="o">=</span> <span class="s2">"#{from_time} --&gt; #{to_time}</span><span class="se">\\</span><span class="s2">n"</span>
  srt_content +<span class="o">=</span> <span class="s2">"#{text}</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n"</span>
end

File.write<span class="o">(</span>srt_file_path, srt_content<span class="o">)</span>
</code></pre></div></div>

<p>It depends on the length of the extracted audio file; this process can take a few seconds or several minutes to complete.</p>

<p>The following is a Ruby script performs all three actions at once: extract audio, transcribe, and transform into SRT file format.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>require <span class="s1">'json'</span>
require <span class="s1">'tmpdir'</span>

def extract_audio<span class="o">(</span><span class="nb">dir</span>, input_video_path<span class="o">)</span>
  <span class="c"># Generate temporary WAV file path based on the input video</span>
  temp_wav_file_path <span class="o">=</span> <span class="s2">"#{dir}/#{File.basename(input_video_path, '.*')}.wav"</span>

  <span class="c"># Construct the ffmpeg command</span>
  ffmpeg_command <span class="o">=</span> <span class="s2">"ffmpeg -i '#{input_video_path}' -ar 16000 -ac 1 -c:a pcm_s16le '#{temp_wav_file_path}'"</span>

  <span class="c"># Execute the ffmpeg command</span>
  puts ffmpeg_command
  system<span class="o">(</span>ffmpeg_command<span class="o">)</span>

  <span class="c"># Check if the command was successful</span>
  <span class="k">if</span> <span class="nv">$?</span>.success?
    puts <span class="s2">"Audio extracted successfully to #{temp_wav_file_path}"</span>
    <span class="k">return </span>temp_wav_file_path
  <span class="k">else
    </span>puts <span class="s2">"Error extracting audio. Please check your ffmpeg installation and the input video file."</span>
    <span class="nb">exit</span><span class="o">(</span>1<span class="o">)</span>
  end
end

def process_wav<span class="o">(</span><span class="nb">dir</span>, wav_file_path<span class="o">)</span>
  <span class="c"># Path to the main command and binary file</span>
  path <span class="o">=</span> <span class="s1">'~/Development/llm/whisper.cpp/'</span>
  main_command <span class="o">=</span> <span class="s1">'main'</span>
  model_file <span class="o">=</span> <span class="s1">'models/ggml-medium.en-q5_0.bin'</span>

  <span class="c"># Generate temporary JSON file path based on the WAV file</span>
  temp_json_file_path <span class="o">=</span> <span class="s2">"#{dir}/#{File.basename(wav_file_path, '.*')}"</span>

  <span class="c"># Construct the full command with quotes around file paths</span>
  full_command <span class="o">=</span> <span class="s2">"#{path}#{main_command} -m #{path}#{model_file} -f '#{wav_file_path}' -oj -ojf '#{temp_json_file_path}'"</span>

  <span class="c"># Execute the command</span>
  puts full_command
  system<span class="o">(</span>full_command<span class="o">)</span>

  <span class="c"># Check if the command was successful</span>
  <span class="k">if</span> <span class="nv">$?</span>.success?
    puts <span class="s2">"Processing completed successfully for #{wav_file_path}"</span>
    <span class="k">return</span> <span class="s2">"#{temp_json_file_path}.wav.json"</span>
  <span class="k">else
    </span>puts <span class="s2">"Error processing the WAV file. Please check your command and the input file."</span>
    <span class="nb">exit</span><span class="o">(</span>1<span class="o">)</span>
  end
end

def process_json_to_srt<span class="o">(</span>json_file_path, srt_file_path<span class="o">)</span>
  json_data <span class="o">=</span> JSON.parse<span class="o">(</span>File.read<span class="o">(</span>json_file_path<span class="o">))</span>

  <span class="c"># Extract 'transcription' array from JSON</span>
  transcription <span class="o">=</span> json_data[<span class="s1">'transcription'</span><span class="o">]</span>
  srt_content <span class="o">=</span> <span class="s2">""</span>

  transcription.each_with_index <span class="k">do</span> |entry, index|
    from_time <span class="o">=</span> entry[<span class="s1">'timestamps'</span><span class="o">][</span><span class="s1">'from'</span><span class="o">]</span>
    to_time <span class="o">=</span> entry[<span class="s1">'timestamps'</span><span class="o">][</span><span class="s1">'to'</span><span class="o">]</span>
    text <span class="o">=</span> entry[<span class="s1">'text'</span><span class="o">]</span>

    srt_content +<span class="o">=</span> <span class="s2">"#{index + 1}</span><span class="se">\n</span><span class="s2">"</span>
    srt_content +<span class="o">=</span> <span class="s2">"#{from_time} --&gt; #{to_time}</span><span class="se">\n</span><span class="s2">"</span>
    srt_content +<span class="o">=</span> <span class="s2">"#{text}</span><span class="se">\n\n</span><span class="s2">"</span>
  end

  <span class="c"># Write SRT content to the new file</span>
  File.write<span class="o">(</span>srt_file_path, srt_content<span class="o">)</span>

  puts <span class="s2">"SRT file created at #{srt_file_path}"</span>
end

<span class="c"># Check if the video file path is provided as a command-line argument</span>
<span class="k">if </span>ARGV.empty?
  puts <span class="s2">"Usage: ruby combined_script.rb path/to/your/video.mp4"</span>
  <span class="nb">exit</span><span class="o">(</span>1<span class="o">)</span>
<span class="k">else
  </span>video_path <span class="o">=</span> ARGV[0]

  Dir.mktmpdir <span class="k">do</span> |dir|
    <span class="c"># Extract audio</span>
    wav_file_path <span class="o">=</span> extract_audio<span class="o">(</span><span class="nb">dir</span>, video_path<span class="o">)</span>

    <span class="c"># Process audio to obtain JSON transcript</span>
    json_file_path <span class="o">=</span> process_wav<span class="o">(</span><span class="nb">dir</span>, wav_file_path<span class="o">)</span>

    <span class="c"># Convert JSON to SRT</span>
    srt_file_path <span class="o">=</span> <span class="s2">"#{File.dirname(video_path)}/#{File.basename(video_path, '.*')}.srt"</span>
    process_json_to_srt<span class="o">(</span>json_file_path, srt_file_path<span class="o">)</span>
  end
end
</code></pre></div></div>

<p>It needs a few changes in the <code class="highlighter-rouge">process_wav</code> method.</p>

<p>First, you need to update the path to your Whisper binaries. And second, the relative path to the binaries of your model.
After these changes, you can create subtitles for your video with the following command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ruby transcribe.rb video.mp4
</code></pre></div></div>

<p>After script completion, you will have a video.srt file next to your video file.</p>

                </div>
              </article>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>


      <!-- Footer -->
<footer class="mt-32 flex-none">
  <div class="sm:px-8">
    <div class="mx-auto w-full max-w-7xl lg:px-8">
      <div class="border-t border-zinc-100 pb-16 pt-10 dark:border-zinc-700/40">
        <div class="relative px-4 sm:px-8 lg:px-12">
          <div class="mx-auto max-w-2xl lg:max-w-5xl">
            <div class="flex flex-col items-center justify-between gap-6 sm:flex-row">
              <div
                class="
                  flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800
                  dark:text-zinc-200
                "
              >
              
                <a
                    href="/about"
                  class="
                    transition hover:text-emerald-500
                    dark:hover:text-emerald-400
                  "
                >
                About
                </a>
              
                <a
                    href="/articles"
                  class="
                    transition hover:text-emerald-500
                    dark:hover:text-emerald-400
                  "
                >
                Articles
                </a>
              
                <a
                    href="/projects"
                  class="
                    transition hover:text-emerald-500
                    dark:hover:text-emerald-400
                  "
                >
                Projects
                </a>
              
              </div>

              <p class="text-sm text-zinc-400 dark:text-zinc-500">
              &copy; 2025 Mario Alberto Chávez. All rights reserved.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

    </div>
  </body>
</html>
