<!doctype html>
<html lang="en" class="h-full antialiased">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Begin Bridgetown SEO tag v7.0.1 -->
<title>Working with Rails Engines, Importmap and TailwindCSS for assets. | Mario Alberto Chávez - Ruby on Rails, AI Tools &amp; former CTO</title>
<meta property="og:title" content="Working with Rails Engines, Importmap and TailwindCSS for assets." />
<meta name="author" content="Mario Alberto Chávez" />
<meta property="og:locale" content="en" />
<meta name="description" content="This is the nonexistent guide on how to work with Rails engines using Importmap and TailwindCSS for assets." />
<meta property="og:description" content="This is the nonexistent guide on how to work with Rails engines using Importmap and TailwindCSS for assets." />
<link rel="canonical" href="https://mariochavez.io/desarrollo/2023/08/23/working-with-rails-engines-importmap-tailwindcss/" />
<meta property="og:url" content="https://mariochavez.io/desarrollo/2023/08/23/working-with-rails-engines-importmap-tailwindcss/" />
<meta property="og:site_name" content="Mario Alberto Chávez - Ruby on Rails, AI Tools &amp; former CTO" />
<meta property="og:image" content="https://mariochavez.io/images/engines-assets/engines-assets.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-23T00:00:00-06:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://mariochavez.io/images/engines-assets/engines-assets.jpg" />
<meta property="twitter:title" content="Working with Rails Engines, Importmap and TailwindCSS for assets." />
<meta name="twitter:site" content="@mario_chavez" />
<meta name="twitter:creator" content="@Mario Alberto Chávez" />
<!-- End Bridgetown SEO tag -->


<link type="application/atom+xml" rel="alternate" href="https://mariochavez.io/feed.xml" title="Mario Alberto Chávez - Ruby on Rails, AI Tools & former CTO" />

<meta property="og:type" content="article">
<meta property="og:site_name" content="Mario Alberto Chávez - Software Development">
<meta name="twitter:card" content="summary_large_image">

<meta name="robots" content="index, follow">
<meta name="revisit-after" content="7 days">

<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<link rel="stylesheet" href="/assets/index.R2XT6LUA.css" />
<script src="/assets/index.OQDTOKYE.js" defer></script>


<script type="application/javascript">
  (function() {
    try {
      const theme = localStorage.getItem('theme');
      if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    } catch (e) {
      // Fail silently
    }
  })();
</script>

<script type="application/ld+json">
  {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": "https://mariochavez.io/#website",
      "url": "https://mariochavez.io/",
      "name": "Mario Alberto Chávez",
      "description": "Ruby on Rails architect and AI toolmaker from Colima, México. Creator of Rails MCP Server, former fintech CTO, and author of Aprendiendo Ruby on Rails. Exploring the convergence of Rails and AI.",
      "publisher": {
        "@type": "Person",
        "@id": "https://mariochavez.io/#person",
        "name": "Mario Alberto Chávez"
      },
    },
    {
      "@type": "CollectionPage",
      "@id": "https://mariochavez.io/#webpage",
      "url": "https://mariochavez.io/",
      "name": "Inicio | Mario Alberto Chávez",
      "isPartOf": {
        "@id": "https://mariochavez.io/#website"
      },
      "about": {
        "@id": "https://mariochavez.io/#person"
      },
      "description": "Ruby on Rails architect and AI toolmaker from Colima, México. Creator of Rails MCP Server, former fintech CTO, and author of Aprendiendo Ruby on Rails. Exploring the convergence of Rails and AI.",
      "breadcrumb": {
        "@id": "https://mariochavez.io/#breadcrumb"
      },
    },
    {
      "@type": "BreadcrumbList",
      "@id": "https://mariochavez.io/#breadcrumb",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Inicio"
        }
      ]
    },
    {
      "@type": "Person",
      "@id": "https://mariochavez.io/#person",
      "name": "Mario Alberto Chávez",
      "image": {
        "@type": "ImageObject",
        "@id": "https://mariochavez.io/#personlogo",
        "inLanguage": "es-MX",
        "url": "https://mariochavez.io/images/mario_chavez.svg",
        "contentUrl": "https://mariochavez.io/images/mario_chavez.svg",
        "caption": "Mario Alberto Chávez"
      },
      "description": "I'm Mario Alberto, a software engineer and entrepreneur based in Colima, México. I'm the creator of Rails MCP Server and former CTO/co-founder of Aoorora, where I architected a core banking platform in Ruby on Rails that enabled lending startups to build on modern, secure infrastructure. I spend my time at the intersection of Ruby on Rails and AI—building tools that help developers work smarter. When I'm not writing code, I'm documenting territory, popular culture, and memory through photography.",
      "sameAs": [
        "https://github.com/mariochavez",
        "https://x.com/mario_chavez",
        "https://linkedin.com/in/mariochavez",
        "https://instagram.com/mario_chavez"
      ]
    }
  ]
}

</script>

  </head>

  <body class="flex h-full flex-col bg-zinc-50 font-manrope dark:bg-black">
    <!-- Outer Frame for the "Card" look on large screens -->
    <div class="fixed inset-0 flex justify-center sm:px-8">
      <div class="flex w-full max-w-7xl lg:px-8">
        <div
          class="
            w-full bg-white ring-1 ring-zinc-100 dark:bg-zinc-900 dark:ring-zinc-300/20
          "
        ></div>
      </div>
    </div>

    <div class="relative flex w-full flex-col">
      <!-- Header / Navigation -->
<header
  data-controller="menu"
  data-menu-open-value=false
  class="pointer-events-none relative z-50 flex flex-none flex-col"
>
  <div class="top-0 z-10 h-16 pt-6">
    <div class="sm:px-8 w-full max-w-7xl mx-auto lg:px-8">
      <div class="relative px-4 sm:px-8 lg:px-12">
        <div class="mx-auto max-w-2xl lg:max-w-5xl">
          <div class="relative flex gap-4">
            <!-- Logo / Avatar -->
            <div class="flex flex-1 pointer-events-auto">
              <a
                href="/"
                class="
                  h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1
                  ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:ring-white/10
                "
              >
                <img
                  src="/images/mario.jpg"
                  alt="Mario Alberto Chávez"
                  class="
                    h-9 w-9 rounded-full bg-zinc-100 object-cover
                    dark:bg-zinc-800
                  "
                >
              </a>
            </div>

            <!-- Desktop Nav -->
            <div class="hidden md:flex flex-1 justify-center pointer-events-auto">
              <nav
                class="
                  flex rounded-full bg-white/90 px-3 text-sm font-medium text-zinc-800 shadow-lg
                  shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90
                  dark:text-zinc-200 dark:ring-white/10
                "
              >
               
                  <a
                      href="/about"
                    class="
                      relative block px-3 py-2 transition hover:text-emerald-500
                      dark:hover:text-emerald-400
                    "
                  >
                  About
                  </a>
                
                  <a
                      href="/articles"
                    class="
                      relative block px-3 py-2 transition hover:text-emerald-500
                      dark:hover:text-emerald-400
                    "
                  >
                  Articles
                  </a>
                
                  <a
                      href="/projects"
                    class="
                      relative block px-3 py-2 transition hover:text-emerald-500
                      dark:hover:text-emerald-400
                    "
                  >
                  Projects
                  </a>
                
              </nav>
            </div>

            <!-- Mobile Menu Button & Theme Toggle -->
            <div class="flex flex-1 justify-end gap-4 pointer-events-auto">
              <!-- Mobile Menu Button -->
              <div class="pointer-events-auto md:hidden">
                <button
                  data-action="menu#toggle"
                  class="
                    group flex items-center rounded-full bg-white/90 px-4 py-2 text-sm font-medium
                    text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur
                    dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10
                    dark:hover:ring-white/20
                  "
                >
                  Menu
                  <i
                    class="
                      ml-3 h-auto w-2 [&_svg]:size-3 stroke-zinc-500 group-hover:stroke-zinc-700
                      dark:group-hover:stroke-zinc-400
                    "
                    
                  ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
</i>
                </button>
              </div>

              <div 
                data-menu-target="overlay"
                data-action="click->menu#toggle"
                class="
                  data-[open=false]:hidden fixed inset-0 z-50 bg-zinc-800/40 backdrop-blur-xs duration-150 
                  opacity-100 data-[open=false]:opacity-0 ease-in dark:bg-black/80
                " 
                aria-hidden="true" 
                data-open="false">
              </div>

              <!-- Theme Toggle (Visual Only) -->
              <button
                  data-controller="theme"
                  data-theme-dark-value
                  data-action="theme#toggle"
                  class="
                    group rounded-full bg-white/90 px-3 py-2 shadow-lg ring-1 shadow-zinc-800/5 ring-zinc-900/5 
                    backdrop-blur-sm transition dark:bg-zinc-800/90 dark:ring-white/10 dark:hover:ring-white/20
                  "
              >
                <i
                  data-theme-target="light"
                  class="
                    [&_svg]:size-5 text-zinc-500 transition group-hover:fill-zinc-200
                    group-hover:text-zinc-700 dark:hidden
                  "
                  ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
</i>

                <i
                  data-theme-target="dark"
                  class="
                    hidden [&_svg]:size-5 text-emerald-700 transition dark:block
                    dark:group-hover:text-emerald-400
                  "
                  ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"/></svg>
</i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Dropdown -->
  <div
    data-menu-target="menu"
    data-open="false"
    class="
      data-[open=false]:hidden opacity-100 data-[open=false]:opacity-0 data-[open=false]:scale-95 
      fixed inset-x-0 top-0 z-50 origin-top rounded-b-2xl bg-zinc-50 px-6 pb-6 pt-24
      shadow-2xl shadow-zinc-900/20 ring-1 ring-zinc-900/5 dark:bg-zinc-900 transition-all ease-out
      dark:ring-zinc-800 pointer-events-auto md:hidden duration-150
    "
  >
    <div class="flex flex-col space-y-4">
      <div class="flex flex-row-reverse items-center justify-between">
        <button 
           data-action="menu#toggle"
           aria-label="Close menu" 
           class="-m-1 p-1 [&_svg]:size-6 text-zinc-500 dark:text-zinc-400" 
           type="button">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="m17.25 6.75-10.5 10.5M6.75 6.75l10.5 10.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
 
        </button>
        <h2 class="text-sm font-medium text-zinc-600 dark:text-zinc-400">Navigation</h2>
      </div>
      
        <a
            href="/about"
          class="block text-base font-semibold text-zinc-800 dark:text-zinc-100"
        >
          About
        </a>
      
        <a
            href="/articles"
          class="block text-base font-semibold text-zinc-800 dark:text-zinc-100"
        >
          Articles
        </a>
      
        <a
            href="/projects"
          class="block text-base font-semibold text-zinc-800 dark:text-zinc-100"
        >
          Projects
        </a>
      
    </div>
  </div>
</header>


      <main class="flex-auto pointer-events-auto">
  <div class="mt-16 sm:px-8 sm:mt-32">
    <div class="mx-auto w-full max-w-7xl lg:px-8">
      <div class="relative px-4 sm:px-8 lg:px-12">
        <div class="mx-auto max-w-2xl lg:max-w-5xl">
          <div class="xl:relative">
            <div class="mx-auto max-w-2xl">
              <!-- Back Button -->
              <a
                href="/articles"
                aria-label="Go back to articles"
                class="
                  group mb-8 flex h-10 w-10 items-center justify-center rounded-full bg-white
                  shadow-md shadow-zinc-800/5 ring-1 ring-zinc-900/5 transition dark:border
                  dark:border-zinc-700/50 dark:bg-zinc-800 dark:ring-0 dark:ring-white/10
                  dark:hover:border-zinc-700 dark:hover:ring-white/20 lg:absolute lg:-left-5
                  lg:-mt-2 lg:mb-0 xl:-top-1.5 xl:left-0 xl:mt-0
                "
              >
                <i
                  class="
                    [&_svg]:size-4 text-zinc-500 transition group-hover:text-zinc-700
                    dark:text-zinc-400 dark:group-hover:text-zinc-300
                  "
                  ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
</i>
              </a>

              <article>
                <header class="flex flex-col">
                  <time
                      datetime="2023-08-23 00:00:00 -0600"
                    class="
                      order-first flex items-center text-base text-zinc-400
                      dark:text-zinc-500
                    "
                  >
                    <span class="h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span>
                    <span class="ml-3">August 23, 2023</span>
                  </time>

                  <h1
                    class="
                      mt-6 text-4xl font-bold tracking-tight text-emerald-700 dark:text-emerald-100
                      sm:text-5xl
                    "
                  >
                  Working with Rails Engines, Importmap and TailwindCSS for assets.
                  </h1>

                  <h3 class="text-2xl text-zinc-600 font-light tracking-tight mt-6 dark:text-zinc-100 sm:text-3xl">This is the nonexistent guide on how to work with Rails engines using Importmap and TailwindCSS for assets.</h3>
                </header>

                <!-- Article Content -->
                <div class="mt-8 prose prose-zinc dark:prose-invert">
                  <p>Rails engines are one of my favorite tools when I want to isolate reusable functionality for Rails applications. An example of this is the NoPassword gem, which allows users to login into an application just with their email and the received link and code.</p>

<p>With Rails 3.1, the engines were mountable and integrated with the Asset Pipeline to manage the engine’s assets. This continued to work this way until Webpack was introduced to Rails in version 5.1. At this moment, it was not clear how to make Webpack work with the engine’s assets or any other gem that included assets.</p>

<p>Rails 7 introduced CSS and JS bundling, along with the Propshaft gem to manage and serve assets. Also, introduced Importmaps and TailwindCSS as options for not having Node as a dependency, but in both cases without any official word on how to make these work with engines.</p>

<p>NOTE: Importmap’s README explains how to composite multiple Impormap configurations. <a href="https://github.com/rails/importmap-rails#composing-import-maps">https://github.com/rails/importmap-rails#composing-import-maps</a></p>

<p>Working on the NoPassword engine and a few private others, I decided for them to use Importmaps, TailwindCSS, and Propshaft. It led me to figure out a way to use the engine assets. The rest of this post describes my successful journey with assets and engines.</p>

<h2 id="importmap-engine-configuration">Importmap engine configuration</h2>

<p>First, let’s try the route described in Importmap’s README file.</p>

<p>To install Importmap in an engine project, it requires adding the gem to the dummy app and adding the dependency to the engine’s gem spec file.</p>

<p>Install Importmap and add it as a dependency to the Gemfile as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle add importmap-rails
</code></pre></div></div>

<p>And add it to the gem spec file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spec.add_dependency <span class="s2">"importmap-rails"</span>, <span class="s2">"~&gt; 1.2"</span>, <span class="s2">"&gt;= 1.2.1"</span>
</code></pre></div></div>

<p>Then run the bundle command and navigate to the test/dummy app to execute the installer in the dummy app.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd test</span>/dummy <span class="o">&amp;&amp;</span> bin/rails importmap::install
</code></pre></div></div>

<p>Following the README instructions for composite Importmaps, open the <code class="highlighter-rouge">lib/my_engine/engine.rb</code> file and add the following hook - remember to replace <strong>**</strong><strong>**</strong><strong>**</strong>my-engine<strong>**</strong><strong>**</strong><strong>**</strong> with the name of your engine -:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">MyEngine</span>
  <span class="k">class</span> <span class="nc">Engine</span> <span class="o">&lt;</span> <span class="o">::</span><span class="no">Rails</span><span class="o">::</span><span class="no">Engine</span>
    <span class="c1"># ...</span>
    <span class="n">initializer</span> <span class="s2">"my-engine.importmap"</span><span class="p">,</span> <span class="ss">before: </span><span class="s2">"importmap"</span> <span class="k">do</span> <span class="o">|</span><span class="n">app</span><span class="o">|</span>
      <span class="n">app</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">importmap</span><span class="p">.</span><span class="nf">paths</span> <span class="o">&lt;&lt;</span> <span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"config/importmap.rb"</span><span class="p">)</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Then create the file <code class="highlighter-rouge">config/importmap.rb</code> and pin the engine’s javascript assets.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pin_all_from File.expand_path<span class="o">(</span><span class="s2">"../app/assets/javascript"</span>, __dir__<span class="o">)</span>
</code></pre></div></div>

<p>To test this setup, two Stimulus controllers were added, one in the engine’s <code class="highlighter-rouge">app/assets/javascript</code> and another one at the dummy app <code class="highlighter-rouge">test/dummy/app/javascript/controllers</code>.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="nx">app</span><span class="o">/</span><span class="nx">javascript</span><span class="o">/</span><span class="nx">controllers</span><span class="o">/</span><span class="nx">host_controller</span><span class="p">.</span><span class="nf">js </span><span class="p">(</span><span class="nx">Dummy</span> <span class="nx">APP</span><span class="p">)</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Controller</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@hotwired/stimulus</span><span class="dl">"</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nc">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
  <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Connected</span><span class="dl">"</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Hello World! This is a Javascript from the Host</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Loaded</span><span class="dl">"</span><span class="p">)</span>

<span class="err">#</span> <span class="nx">app</span><span class="o">/</span><span class="nx">assets</span><span class="o">/</span><span class="nx">javascript</span><span class="o">/</span><span class="nx">engine_controller</span><span class="p">.</span><span class="nf">js </span><span class="p">(</span><span class="nx">Engine</span><span class="p">)</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Controller</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@hotwired/stimulus</span><span class="dl">"</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nc">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
  <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Connected</span><span class="dl">"</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Hello World! This is a Javascript from the Engine</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Loaded</span><span class="dl">"</span><span class="p">)</span>
</code></pre></div></div>

<p>Set up Stimulus in the dummy app by adding the gem and running the installer.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd test</span>/dummy
bundle add stimulus-rails
./bin/rails stimulus:install
</code></pre></div></div>

<p>The Dummy app has a <strong>HomeController</strong> with an index action. The index template has two divs. One for <code class="highlighter-rouge">host_controller.js</code> and the second one for <code class="highlighter-rouge">engine_controller.js</code> .</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Engine's Stimulus controller (Host app)<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;div</span> <span class="na">data-controller=</span><span class="s">"host"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">data-controller=</span><span class="s">"engine"</span><span class="nt">&gt;&lt;/div&gt;</span>
</code></pre></div></div>

<p><img src="/images/engines-assets/importmap-1.png" alt="Importmap" /></p>

<p>Unfortunately, this setup does not work, at least for my use case, where I expect the engine to have Stimulus controllers available in the host application, the Dummy app in this case. The engine’s controller is there in the imports manifest but is not loaded in the context of the Stimulus application.</p>

<p>The way that I make this work is to first organize the engine’s Stimulus controllers with the following directory structure: <code class="highlighter-rouge">app/assets/javascript/my_engine/controllers</code></p>

<p>Next, modify the Dummy app’s <code class="highlighter-rouge">config/importmap.rb</code> and add the following line at the end of the file.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pin_all_from</span> <span class="no">MyEngine</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"app/assets/javascript/my_engine/controllers"</span><span class="p">),</span> <span class="ss">under: </span><span class="s2">"controllers"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"my_engine/controllers"</span>
</code></pre></div></div>

<p>With this change, reload the page, and now it is working! The engine’s Stimulus controller is loaded by the host application.</p>

<p><img src="/images/engines-assets/importmap-2.png" alt="Importmap" /></p>

<p>In the Importmap repository, there is an open issue about how to make the gem work with engines, and the user muriloime mentions this solution <a href="https://github.com/rails/importmap-rails/issues/58">https://github.com/rails/importmap-rails/issues/58</a></p>

<p>Now, what about making Importmap work with the engine’s own views? In the case of the NoPassword gem, it provides views for the login process and uses a Stimulus controller to display errors; it does not depend on the host application in any way.</p>

<p><img src="/images/engines-assets/no-password-demo.gif" alt="No Password" /></p>

<p>First, add Stimulus as a gem dependency to the gem spec file and execute the bundle command.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spec</span><span class="p">.</span><span class="nf">add_dependency</span> <span class="s2">"stimulus-rails"</span><span class="p">,</span> <span class="s2">"~&gt; 1.2"</span>
</code></pre></div></div>

<p>The installer is not available inside the engine, so this step requires adding a few files manually. Let’s start with the javascript files.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="nx">app</span><span class="o">/</span><span class="nx">assets</span><span class="o">/</span><span class="nx">javascript</span><span class="o">/</span><span class="nx">my_engine</span><span class="o">/</span><span class="nx">application</span><span class="p">.</span><span class="nx">js</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">controllers</span><span class="dl">"</span>

<span class="err">#</span> <span class="nx">app</span><span class="o">/</span><span class="nx">assets</span><span class="o">/</span><span class="nx">javascript</span><span class="o">/</span><span class="nx">my_engine</span><span class="o">/</span><span class="nx">controllers</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span>
<span class="c1">// Import and register all your controllers from the importmap under controllers/*</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">application</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">controllers/application</span><span class="dl">"</span>

<span class="c1">// Eager load all controllers defined in the import map under controllers/**/*_controller</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">eagerLoadControllersFrom</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@hotwired/stimulus-loading</span><span class="dl">"</span>
<span class="nf">eagerLoadControllersFrom</span><span class="p">(</span><span class="dl">"</span><span class="s2">controllers</span><span class="dl">"</span><span class="p">,</span> <span class="nx">application</span><span class="p">)</span>

<span class="c1">// Lazy load controllers as they appear in the DOM (remember not to preload controllers in import map!)</span>
<span class="c1">// import { lazyLoadControllersFrom } from "@hotwired/stimulus-loading"</span>
<span class="c1">// lazyLoadControllersFrom("controllers", application)</span>

<span class="err">#</span> <span class="nx">app</span><span class="o">/</span><span class="nx">assets</span><span class="o">/</span><span class="nx">javascript</span><span class="o">/</span><span class="nx">my_engine</span><span class="o">/</span><span class="nx">controllers</span><span class="o">/</span><span class="nx">application</span><span class="p">.</span><span class="nx">js</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Application</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@hotwired/stimulus</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">application</span> <span class="o">=</span> <span class="nx">Application</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="c1">// Configure Stimulus development experience</span>
<span class="nx">application</span><span class="p">.</span><span class="nx">debug</span> <span class="o">=</span> <span class="kc">false</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">Stimulus</span>   <span class="o">=</span> <span class="nx">application</span>

<span class="k">export</span> <span class="p">{</span> <span class="nx">application</span> <span class="p">}</span>
</code></pre></div></div>

<p>Open the file <code class="highlighter-rouge">config/importmap.rb</code> and replace the content with the following pins that load Stimulus and the engine’s controllers:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pin</span> <span class="s2">"@hotwired/stimulus"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"stimulus.min.js"</span><span class="p">,</span> <span class="ss">preload: </span><span class="kp">true</span>
<span class="n">pin</span> <span class="s2">"@hotwired/stimulus-loading"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"stimulus-loading.js"</span><span class="p">,</span> <span class="ss">preload: </span><span class="kp">true</span>

<span class="n">pin</span> <span class="s2">"application"</span><span class="p">,</span> <span class="ss">preload: </span><span class="kp">true</span>

<span class="n">pin_all_from</span> <span class="no">MyEngine</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"app/assets/javascript/my_engine/controllers"</span><span class="p">),</span> <span class="ss">under: </span><span class="s2">"controllers"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"my_engine/controllers"</span>
</code></pre></div></div>

<p>Instead of composing a global Importmap, we are going to set up a local configuration for the engine. Open the <code class="highlighter-rouge">lib/my_engine.rb</code> file and add the following code:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"my_engine/version"</span>
<span class="nb">require</span> <span class="s2">"my_engine/engine"</span>

<span class="nb">require</span> <span class="s2">"importmap-rails"</span>

<span class="k">module</span> <span class="nn">MyEngine</span>
  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="nb">attr_accessor</span> <span class="ss">:configuration</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Configuration</span>
    <span class="nb">attr_reader</span> <span class="ss">:importmap</span>

    <span class="k">def</span> <span class="nf">initialize</span>
      <span class="vi">@importmap</span> <span class="o">=</span> <span class="no">Importmap</span><span class="o">::</span><span class="no">Map</span><span class="p">.</span><span class="nf">new</span>
      <span class="vi">@importmap</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"config/importmap.rb"</span><span class="p">))</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">init_config</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">configuration</span> <span class="o">||=</span> <span class="no">Configuration</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">configure</span>
    <span class="n">init_config</span>
    <span class="k">yield</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">MyEngine</span><span class="p">.</span><span class="nf">init_config</span>
</code></pre></div></div>

<p>Here, a configuration class was added to the engine. It has only one setting, where it initializes a new Importmap with assets belonging to the engine. Be aware that sweepers are not set up for Importmap; this means that changes made during development with the engine will not be taken until the app is restarted.
This configuration can be extended to include more engine settings if needed.</p>

<p>Now we need to create a helper similar to <code class="highlighter-rouge">javascript_importmap_tag</code> that is aware of the engine’s Importmap configuration. Open the <code class="highlighter-rouge">app/helpers/my_engine/application_helper.rb</code> and add the following method.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">my_engine_importmap_tags</span><span class="p">(</span><span class="n">entry_point</span> <span class="o">=</span> <span class="s2">"application"</span><span class="p">,</span> <span class="ss">shim: </span><span class="kp">true</span><span class="p">)</span>
  <span class="n">safe_join</span> <span class="p">[</span>
    <span class="n">javascript_inline_importmap_tag</span><span class="p">(</span><span class="no">MyEngine</span><span class="p">.</span><span class="nf">configuration</span><span class="p">.</span><span class="nf">importmap</span><span class="p">.</span><span class="nf">to_json</span><span class="p">(</span><span class="ss">resolver: </span><span class="nb">self</span><span class="p">)),</span>
    <span class="n">javascript_importmap_module_preload_tags</span><span class="p">(</span><span class="no">MyEngine</span><span class="p">.</span><span class="nf">configuration</span><span class="p">.</span><span class="nf">importmap</span><span class="p">),</span>
    <span class="p">(</span><span class="n">javascript_importmap_shim_nonce_configuration_tag</span> <span class="k">if</span> <span class="n">shim</span><span class="p">),</span>
    <span class="p">(</span><span class="n">javascript_importmap_shim_tag</span> <span class="k">if</span> <span class="n">shim</span><span class="p">),</span>
    <span class="n">javascript_import_module_tag</span><span class="p">(</span><span class="n">entry_point</span><span class="p">)</span>
  <span class="p">].</span><span class="nf">compact</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now open the engine’s layout and replace the <code class="highlighter-rouge">javascript_importmap_tag</code> with <code class="highlighter-rouge">my_engine_importmap_tags</code>.</p>

<p>To test this, add a controller named <code class="highlighter-rouge">MyEngine::HomeController</code> with an index action and a div that uses <code class="highlighter-rouge">engine_controller.js</code> to it.</p>

<p><img src="/images/engines-assets/importmap-3.png" alt="Importmap" /></p>

<p>These are the two configuration options for Importmap with engines. Share the engine’s Stimulus controllers with the host app, or use the engine’s Stimulus controllers internally for the engine’s templates.</p>

<h2 id="tailwindcss-engine-configuration">TailwindCSS engine configuration</h2>

<p>The steps to install it are simple. First, let’s install it into the Dummy app.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd test</span>/dummy <span class="o">&amp;&amp;</span> bundle add tailwindcss-rails
./bin/rails tailwindcss:install
</code></pre></div></div>

<p>For the Dummy app that comes with the engine in development mode, there are two additional steps that are not required when the host app is not the Dummy app.</p>

<p>Ensure that the TailwindCSS task runs with Foreman or Overmind using your <code class="highlighter-rouge">Procfile.dev</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>web: bin/rails server <span class="nt">-p</span> 3000
css: bin/rails app:tailwindcss:watch
</code></pre></div></div>

<p>Also, change the <code class="highlighter-rouge">test/dummy/config/tailwind.config.js</code> file that was installed by TailwindCSS to have the right path to the Dummy app. Change the content section to include the <code class="highlighter-rouge">./test/dummy</code> path.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>content: <span class="o">[</span>
    <span class="s1">'./test/dummy/public/*.html'</span>,
    <span class="s1">'./test/dummy/app/helpers/**/*.rb'</span>,
    <span class="s1">'./test/dummy/app/javascript/**/*.js'</span>,
    <span class="s1">'./test/dummy/app/views/**/*.{erb,haml,html,slim}'</span>
  <span class="o">]</span>,
</code></pre></div></div>

<p>Restart your application, and it should work for the Dummy app.</p>

<p><img src="/images/engines-assets/tailwind-1.png" alt="TailwindCSS" /></p>

<p>To extend the TailwindCSS styling into the engine’s templates, there are a few steps that need to be taken first. The host app, in our case, the Dummy app, needs to override the engine’s layout to include the TailwindCSS files. Copy the file <code class="highlighter-rouge">app/layouts/my_engine/application.html.erb</code> to <code class="highlighter-rouge">test/dummy/app/layouts/my_engine/application.html.erb</code> and add the following line in the <strong>head</strong> section:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;%<span class="o">=</span> stylesheet_link_tag <span class="s2">"tailwind"</span>, <span class="s2">"inter-font"</span>, <span class="s2">"data-turbo-track"</span>: <span class="s2">"reload"</span> %&gt;
</code></pre></div></div>

<p>Navigate to an engine action, and you can confirm the general CSS reset of TailwindCSS is applied, but utility classes are ignored.</p>

<p><img src="/images/engines-assets/tailwind-2.png" alt="TailwindCSS" /></p>

<p>This happens because the file doesn’t know that it also needs to scan the engine templates for TailwindCSS classes.</p>

<p>To fix this, we need a rake task and a generator in the host or Dummy app. Create a file <code class="highlighter-rouge">test/dummy/lib/tasks/tailwind.rake</code> and add the following content:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># frozen_string_literal: true</span>

<span class="n">namespace</span> <span class="ss">:tailwindcss</span> <span class="k">do</span>
  <span class="n">desc</span> <span class="s2">"Generates your tailwind config file"</span>
  <span class="n">task</span> <span class="ss">:config</span> <span class="k">do</span>
    <span class="no">Rails</span><span class="o">::</span><span class="no">Generators</span><span class="p">.</span><span class="nf">invoke</span><span class="p">(</span><span class="s2">"tailwind_config"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"--force"</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Rake</span><span class="o">::</span><span class="no">Task</span><span class="p">[</span><span class="s2">"tailwindcss:build"</span><span class="p">].</span><span class="nf">enhance</span><span class="p">([</span><span class="s2">"tailwindcss:config"</span><span class="p">])</span>
<span class="no">Rake</span><span class="o">::</span><span class="no">Task</span><span class="p">[</span><span class="s2">"tailwindcss:watch"</span><span class="p">].</span><span class="nf">enhance</span><span class="p">([</span><span class="s2">"tailwindcss:config"</span><span class="p">])</span>
</code></pre></div></div>

<p>Here we are adding a <strong>tailwindcss:config</strong> task that invokes a generator (we are going to create this one in a moment) and enhancing TailwindCSS tasks provided by the gem by injecting this new task into the build process.</p>

<p>For the generator, create the file <code class="highlighter-rouge">test/dummy/lib/generators/tailwind_config_generator.rb</code> in the host or Dummy app and add the following code:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># frozen_string_literal: true</span>

<span class="k">class</span> <span class="nc">TailwindConfigGenerator</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Generators</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">source_root</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"../templates"</span><span class="p">,</span> <span class="kp">__FILE__</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">create_tailwind_config_file</span>
    <span class="vi">@engines_paths</span> <span class="o">=</span> <span class="no">MyEngine</span><span class="p">.</span><span class="nf">configuration</span><span class="p">.</span><span class="nf">tailwind_content</span>

    <span class="c1"># The second parameter for the template method is required only if the host app is the Dummy app; </span>
    <span class="c1"># for an external host app, remove that parameter.</span>
    <span class="n">template</span> <span class="s2">"config/tailwind.config.js"</span><span class="p">,</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"../../../config/tailwind.config.js"</span><span class="p">,</span> <span class="kp">__FILE__</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This generator, when executed, creates a new TailwindCSS config file from a template, but before doing that, in the <code class="highlighter-rouge">create_tailwind_config_file</code> method, we can set up the engine paths to consider when scanning for TailwindCSS classes.</p>

<p>In the code, the generator assumes that our engine configuration exposes a <code class="highlighter-rouge">tailwind_content</code> accessor with an array of paths.</p>

<p>Add an accessor to the Configuration class in file <code class="highlighter-rouge">lib/my_engine.rb</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">attr_accessor</span> <span class="ss">:tailwind_content</span>
</code></pre></div></div>

<p>Also add to the <code class="highlighter-rouge">initializer</code> method of the same class the following paths:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vi">@tailwind_content</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">"</span><span class="si">#{</span><span class="no">MyEngine</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="si">}</span><span class="s2">/app/views/**/*"</span><span class="p">,</span>
  <span class="s2">"</span><span class="si">#{</span><span class="no">MyEngine</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="si">}</span><span class="s2">/app/helpers/**/*"</span><span class="p">,</span>
  <span class="s2">"</span><span class="si">#{</span><span class="no">MyEngine</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="si">}</span><span class="s2">/app/controllers/**/*"</span><span class="p">,</span>
  <span class="s2">"</span><span class="si">#{</span><span class="no">MyEngine</span><span class="o">::</span><span class="no">Engine</span><span class="p">.</span><span class="nf">root</span><span class="si">}</span><span class="s2">/app/javascript/**/*.js"</span>
<span class="p">]</span>
</code></pre></div></div>

<p>Moving back to the template file in the <code class="highlighter-rouge">tailwind_config_generator</code>, this is the TailwindCSS config file, but it will be created dynamically by the task to be able to inject the engine paths into it.</p>

<p>Move the file <code class="highlighter-rouge">test/dummy/config/tailwind.config.js</code> to <code class="highlighter-rouge">lib/generators/templates/config/tailwind.config.js.tt</code> and modify the <strong>content</strong> section as follows:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="ss">content: </span><span class="p">[</span>
    <span class="s1">'./test/dummy/public/*.html'</span><span class="p">,</span>
    <span class="s1">'./test/dummy/app/helpers/**/*.rb'</span><span class="p">,</span>
    <span class="s1">'./test/dummy/app/javascript/**/*.js'</span><span class="p">,</span>
    <span class="s1">'./test/dummy/app/views/**/*.{erb,haml,html,slim}'</span><span class="p">,</span>
    <span class="o">&lt;</span><span class="sx">%= @engines_paths.map{ |path| "'</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="sx">'" }.join(",</span><span class="se">\n</span><span class="sx">") %&gt;
  ],
</span></code></pre></div></div>

<p>Add the file <code class="highlighter-rouge">test/dummy/config/tailwind.config.js</code> to <code class="highlighter-rouge">.gitignore</code> file, since this file will be generated automatically.</p>

<p>Restart the application, navigate the view in the host app and a view in the engine, and confirm that TailwindCSS is working for both cases.</p>

<p><img src="/images/engines-assets/tailwind-3.png" alt="TailwindCSS" /></p>

<p><img src="/images/engines-assets/tailwind-4.png" alt="TailwindCSS" /></p>

<h2 id="wrapping-up">Wrapping up</h2>

<p>This is how I have been working with the Rails engines Importmap and TailwindCSS. Most of the knowledge here came from reading the source code of the libraries and trial and error.</p>

<p>If you are looking to work with engines and this tool set for assets, please give it a try and let me know how it goes or if there is a better, simpler way to archive the same.</p>

                </div>
              </article>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>


      <!-- Footer -->
<footer class="mt-32 flex-none">
  <div class="sm:px-8">
    <div class="mx-auto w-full max-w-7xl lg:px-8">
      <div class="border-t border-zinc-100 pb-16 pt-10 dark:border-zinc-700/40">
        <div class="relative px-4 sm:px-8 lg:px-12">
          <div class="mx-auto max-w-2xl lg:max-w-5xl">
            <div class="flex flex-col items-center justify-between gap-6 sm:flex-row">
              <div
                class="
                  flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800
                  dark:text-zinc-200
                "
              >
              
                <a
                    href="/about"
                  class="
                    transition hover:text-emerald-500
                    dark:hover:text-emerald-400
                  "
                >
                About
                </a>
              
                <a
                    href="/articles"
                  class="
                    transition hover:text-emerald-500
                    dark:hover:text-emerald-400
                  "
                >
                Articles
                </a>
              
                <a
                    href="/projects"
                  class="
                    transition hover:text-emerald-500
                    dark:hover:text-emerald-400
                  "
                >
                Projects
                </a>
              
              </div>

              <p class="text-sm text-zinc-400 dark:text-zinc-500">
              &copy; 2025 Mario Alberto Chávez. All rights reserved.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

    </div>
  </body>
</html>
