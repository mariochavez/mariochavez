<!doctype html>
<html lang="en" class="h-full antialiased">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Begin Bridgetown SEO tag v7.0.1 -->
<title>No build for Javascript libraries with Rails and Importmap | Mario Alberto Chávez - Ruby on Rails, AI Tools &amp; former CTO</title>
<meta property="og:title" content="No build for Javascript libraries with Rails and Importmap" />
<meta name="author" content="Mario Alberto Chávez" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learn how to simplify JavaScript management in Ruby on Rails using Importmaps. Discover local pinning, CDN integration, and Stimulus controller implementation with Chart.js" />
<meta property="og:description" content="Learn how to simplify JavaScript management in Ruby on Rails using Importmaps. Discover local pinning, CDN integration, and Stimulus controller implementation with Chart.js" />
<link rel="canonical" href="https://mariochavez.io/desarrollo/2024/08/09/no-build-javascript-rails-importmap/" />
<meta property="og:url" content="https://mariochavez.io/desarrollo/2024/08/09/no-build-javascript-rails-importmap/" />
<meta property="og:site_name" content="Mario Alberto Chávez - Ruby on Rails, AI Tools &amp; former CTO" />
<meta property="og:image" content="https://mariochavez.io/images/no-build/no-build.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-08-09T12:00:00-06:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://mariochavez.io/images/no-build/no-build.jpg" />
<meta property="twitter:title" content="No build for Javascript libraries with Rails and Importmap" />
<meta name="twitter:site" content="@mario_chavez" />
<meta name="twitter:creator" content="@Mario Alberto Chávez" />
<!-- End Bridgetown SEO tag -->


<link type="application/atom+xml" rel="alternate" href="https://mariochavez.io/feed.xml" title="Mario Alberto Chávez - Ruby on Rails, AI Tools & former CTO" />

<meta property="og:type" content="article">
<meta property="og:site_name" content="Mario Alberto Chávez - Software Development">
<meta name="twitter:card" content="summary_large_image">

<meta name="robots" content="index, follow">
<meta name="revisit-after" content="7 days">

<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<link rel="stylesheet" href="/assets/index.R2XT6LUA.css" />
<script src="/assets/index.OQDTOKYE.js" defer></script>


<script type="application/javascript">
  (function() {
    try {
      const theme = localStorage.getItem('theme');
      if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    } catch (e) {
      // Fail silently
    }
  })();
</script>

<script type="application/ld+json">
  {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://mariochavez.io/desarrollo/2024/08/09/no-build-javascript-rails-importmap/"
  },
  "headline": "No build for Javascript libraries with Rails and Importmap",
  "datePublished": "2024-08-09",
  "dateModified": "2024-08-09",
  "author": {
    "@type": "Person",
    "name": "Mario Alberto Chávez Cárdenas"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Mario Alberto Chávez Cárdenas",
    "logo": {
      "@type": "ImageObject",
      "url": "https://mariochavez.io/logo.png"
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "https://mariochavez.io/images/no-build/no-build.jpg",
    "height": 630,
    "width": 1200
  },
  "description": "Learn how to use Importmap in Ruby on Rails for managing JavaScript libraries without a build step, including troubleshooting tips for integrating third-party libraries like Chart.js.",
  "articleBody": "As a web developer working with Ruby on Rails, you're always looking for ways to streamline your workflow and make your applications more efficient. Enter Importmap - a powerful feature that simplifies how you manage JavaScript libraries in your Rails projects. In this post, we'll dive into what Importmap is, how it works, and how you can use it for your projects.",
  "keywords": [
    "Ruby on Rails",
    "Importmap",
    "JavaScript",
    "Chart.js",
    "No build",
    "Web development"
  ],
  "articleSection": "Desarrollo",
  "inLanguage": "en-US",
  "isAccessibleForFree": "True",
  "hasPart": [
    {
      "@type": "WebPageElement",
      "isAccessibleForFree": "True",
      "cssSelector": ".prose"
    }
  ],
  "speakable": {
    "@type": "SpeakableSpecification",
    "cssSelector": [
      "article h1",
      "article h2",
      "article p"
    ]
  },
  "mentions": [
    {
      "@type": "SoftwareApplication",
      "name": "Ruby on Rails",
      "operatingSystem": "All"
    },
    {
      "@type": "SoftwareApplication",
      "name": "Chart.js",
      "operatingSystem": "All"
    } 
  ]
}

</script>

  </head>

  <body class="flex h-full flex-col bg-zinc-50 font-manrope dark:bg-black">
    <!-- Outer Frame for the "Card" look on large screens -->
    <div class="fixed inset-0 flex justify-center sm:px-8">
      <div class="flex w-full max-w-7xl lg:px-8">
        <div
          class="
            w-full bg-white ring-1 ring-zinc-100 dark:bg-zinc-900 dark:ring-zinc-300/20
          "
        ></div>
      </div>
    </div>

    <div class="relative flex w-full flex-col">
      <!-- Header / Navigation -->
<header
  data-controller="menu"
  data-menu-open-value=false
  class="pointer-events-none relative z-50 flex flex-none flex-col"
>
  <div class="top-0 z-10 h-16 pt-6">
    <div class="sm:px-8 w-full max-w-7xl mx-auto lg:px-8">
      <div class="relative px-4 sm:px-8 lg:px-12">
        <div class="mx-auto max-w-2xl lg:max-w-5xl">
          <div class="relative flex gap-4">
            <!-- Logo / Avatar -->
            <div class="flex flex-1 pointer-events-auto">
              <a
                href="/"
                class="
                  h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1
                  ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:ring-white/10
                "
              >
                <img
                  src="/images/mario.jpg"
                  alt="Mario Alberto Chávez"
                  class="
                    h-9 w-9 rounded-full bg-zinc-100 object-cover
                    dark:bg-zinc-800
                  "
                >
              </a>
            </div>

            <!-- Desktop Nav -->
            <div class="hidden md:flex flex-1 justify-center pointer-events-auto">
              <nav
                class="
                  flex rounded-full bg-white/90 px-3 text-sm font-medium text-zinc-800 shadow-lg
                  shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90
                  dark:text-zinc-200 dark:ring-white/10
                "
              >
               
                  <a
                      href="/about"
                    class="
                      relative block px-3 py-2 transition hover:text-emerald-500
                      dark:hover:text-emerald-400
                    "
                  >
                  About
                  </a>
                
                  <a
                      href="/articles"
                    class="
                      relative block px-3 py-2 transition hover:text-emerald-500
                      dark:hover:text-emerald-400
                    "
                  >
                  Articles
                  </a>
                
                  <a
                      href="/projects"
                    class="
                      relative block px-3 py-2 transition hover:text-emerald-500
                      dark:hover:text-emerald-400
                    "
                  >
                  Projects
                  </a>
                
              </nav>
            </div>

            <!-- Mobile Menu Button & Theme Toggle -->
            <div class="flex flex-1 justify-end gap-4 pointer-events-auto">
              <!-- Mobile Menu Button -->
              <div class="pointer-events-auto md:hidden">
                <button
                  data-action="menu#toggle"
                  class="
                    group flex items-center rounded-full bg-white/90 px-4 py-2 text-sm font-medium
                    text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur
                    dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10
                    dark:hover:ring-white/20
                  "
                >
                  Menu
                  <i
                    class="
                      ml-3 h-auto w-2 [&_svg]:size-3 stroke-zinc-500 group-hover:stroke-zinc-700
                      dark:group-hover:stroke-zinc-400
                    "
                    
                  ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
</i>
                </button>
              </div>

              <div 
                data-menu-target="overlay"
                data-action="click->menu#toggle"
                class="
                  data-[open=false]:hidden fixed inset-0 z-50 bg-zinc-800/40 backdrop-blur-xs duration-150 
                  opacity-100 data-[open=false]:opacity-0 ease-in dark:bg-black/80
                " 
                aria-hidden="true" 
                data-open="false">
              </div>

              <!-- Theme Toggle (Visual Only) -->
              <button
                  data-controller="theme"
                  data-theme-dark-value
                  data-action="theme#toggle"
                  class="
                    group rounded-full bg-white/90 px-3 py-2 shadow-lg ring-1 shadow-zinc-800/5 ring-zinc-900/5 
                    backdrop-blur-sm transition dark:bg-zinc-800/90 dark:ring-white/10 dark:hover:ring-white/20
                  "
              >
                <i
                  data-theme-target="light"
                  class="
                    [&_svg]:size-5 text-zinc-500 transition group-hover:fill-zinc-200
                    group-hover:text-zinc-700 dark:hidden
                  "
                  ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
</i>

                <i
                  data-theme-target="dark"
                  class="
                    hidden [&_svg]:size-5 text-emerald-700 transition dark:block
                    dark:group-hover:text-emerald-400
                  "
                  ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"/></svg>
</i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Dropdown -->
  <div
    data-menu-target="menu"
    data-open="false"
    class="
      data-[open=false]:hidden opacity-100 data-[open=false]:opacity-0 data-[open=false]:scale-95 
      fixed inset-x-0 top-0 z-50 origin-top rounded-b-2xl bg-zinc-50 px-6 pb-6 pt-24
      shadow-2xl shadow-zinc-900/20 ring-1 ring-zinc-900/5 dark:bg-zinc-900 transition-all ease-out
      dark:ring-zinc-800 pointer-events-auto md:hidden duration-150
    "
  >
    <div class="flex flex-col space-y-4">
      <div class="flex flex-row-reverse items-center justify-between">
        <button 
           data-action="menu#toggle"
           aria-label="Close menu" 
           class="-m-1 p-1 [&_svg]:size-6 text-zinc-500 dark:text-zinc-400" 
           type="button">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="m17.25 6.75-10.5 10.5M6.75 6.75l10.5 10.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
 
        </button>
        <h2 class="text-sm font-medium text-zinc-600 dark:text-zinc-400">Navigation</h2>
      </div>
      
        <a
            href="/about"
          class="block text-base font-semibold text-zinc-800 dark:text-zinc-100"
        >
          About
        </a>
      
        <a
            href="/articles"
          class="block text-base font-semibold text-zinc-800 dark:text-zinc-100"
        >
          Articles
        </a>
      
        <a
            href="/projects"
          class="block text-base font-semibold text-zinc-800 dark:text-zinc-100"
        >
          Projects
        </a>
      
    </div>
  </div>
</header>


      <main class="flex-auto pointer-events-auto">
  <div class="mt-16 sm:px-8 sm:mt-32">
    <div class="mx-auto w-full max-w-7xl lg:px-8">
      <div class="relative px-4 sm:px-8 lg:px-12">
        <div class="mx-auto max-w-2xl lg:max-w-5xl">
          <div class="xl:relative">
            <div class="mx-auto max-w-2xl">
              <!-- Back Button -->
              <a
                href="/articles"
                aria-label="Go back to articles"
                class="
                  group mb-8 flex h-10 w-10 items-center justify-center rounded-full bg-white
                  shadow-md shadow-zinc-800/5 ring-1 ring-zinc-900/5 transition dark:border
                  dark:border-zinc-700/50 dark:bg-zinc-800 dark:ring-0 dark:ring-white/10
                  dark:hover:border-zinc-700 dark:hover:ring-white/20 lg:absolute lg:-left-5
                  lg:-mt-2 lg:mb-0 xl:-top-1.5 xl:left-0 xl:mt-0
                "
              >
                <i
                  class="
                    [&_svg]:size-4 text-zinc-500 transition group-hover:text-zinc-700
                    dark:text-zinc-400 dark:group-hover:text-zinc-300
                  "
                  ><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
</i>
              </a>

              <article>
                <header class="flex flex-col">
                  <time
                      datetime="2024-08-09 12:00:00 -0600"
                    class="
                      order-first flex items-center text-base text-zinc-400
                      dark:text-zinc-500
                    "
                  >
                    <span class="h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span>
                    <span class="ml-3">August 09, 2024</span>
                  </time>

                  <h1
                    class="
                      mt-6 text-4xl font-bold tracking-tight text-emerald-700 dark:text-emerald-100
                      sm:text-5xl
                    "
                  >
                  No build for Javascript libraries with Rails and Importmap
                  </h1>

                  <h3 class="text-2xl text-zinc-600 font-light tracking-tight mt-6 dark:text-zinc-100 sm:text-3xl">Learn how to simplify JavaScript management in Ruby on Rails using Importmaps. Discover local pinning, CDN integration, and Stimulus controller implementation with Chart.js</h3>
                </header>

                <!-- Article Content -->
                <div class="mt-8 prose prose-zinc dark:prose-invert">
                  <p>As a web developer working with Ruby on Rails, you’re always looking for ways to streamline your workflow and make your applications more efficient. Enter Importmap - a powerful feature that simplifies how you manage JavaScript libraries in your Rails projects. In this post, we’ll dive into what Importmap is, how it works, and how you can use it for your projects.</p>

<h2 id="what-is-importmap">What is Importmap?</h2>

<p>Importmap is a way to map JavaScript module names to their actual locations. They allow you to use <code class="highlighter-rouge">import</code> statements in your JavaScript code without needing a bundler like Webpack or Rollup. This means you can use modern JavaScript modules directly in the browser, making your development process simpler and faster.</p>

<h2 id="how-does-importmap-work">How does Importmap work?</h2>

<ol>
  <li><strong>Mapping</strong>: Importmaps create a mapping between a module name and its location.</li>
  <li><strong>Browser Support</strong>: Modern browsers use this mapping to load modules when they encounter <code class="highlighter-rouge">import</code> statements.</li>
  <li><strong>Rails Integration</strong>: Rails 7+ includes built-in support for Importmap, making it easy to use in your projects.</li>
  <li><strong>Local Pinning</strong>: By default, Rails pins libraries locally, copying the code to your project into the <code class="highlighter-rouge">vendor/javascript</code> folder. While this might feel similar to how JavaScript libraries were vendored in older Rails projects, Importmap provides a modern tool for managing dependencies and versions.</li>
</ol>

<h2 id="practical-tips-for-using-importmap-in-rails">Practical tips for using Importmap in Rails</h2>

<h3 id="1-setting-up-importmap">1. Setting up Importmap</h3>

<p>For a new Rails application, Importmap is set up by default. If you want to add it to an existing application, then follow these steps.</p>

<p>To get started with Importmap in your Rails project, add this to your Gemfile:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="s2">"importmap-rails"</span>
</code></pre></div></div>

<p>Then run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle install
bin/rails importmap:install
</code></pre></div></div>

<p>This sets up the necessary files and configurations.</p>

<h3 id="2-adding-javascript-libraries">2. Adding JavaScript libraries</h3>

<p>To add a library, use the <code class="highlighter-rouge">pin</code> option with <code class="highlighter-rouge">bin/importmap</code> command. Let’s use Chart.js as an example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> bin/importmap pin chart.js
Pinning <span class="s2">"chart.js"</span> to vendor/javascript/chart.js.js via download from https://ga.jspm.io/npm:chart.js@4.4.3/dist/chart.js
Pinning <span class="s2">"@kurkle/color"</span> to vendor/javascript/@kurkle/color.js via download from https://ga.jspm.io/npm:@kurkle/color@0.3.2/dist/color.esm.js
</code></pre></div></div>

<p>This command performs the following steps::</p>

<ol>
  <li>Download Chart.js and its dependencies.</li>
  <li>Place the files in the <code class="highlighter-rouge">vendor/javascript</code> directory.</li>
  <li>Update the <code class="highlighter-rouge">config/importmap.rb</code> file with the correct local paths.</li>
</ol>

<p>This is the contents of <code class="highlighter-rouge">vendor/javascript</code> directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">ls </span>vendor/javascript
8.5k  9 Aug 12:53 <span class="nt">-N</span>  @kurkle--color.js
186k  9 Aug 12:53 <span class="nt">-N</span>  chart.js.js
</code></pre></div></div>

<p>The <code class="highlighter-rouge">config/importmap.rb</code> looks as follows with the pinned libraries.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pin</span> <span class="s1">'chart.js'</span> <span class="c1"># @4.4.3</span>
<span class="n">pin</span> <span class="s1">'@kurkle/color'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'@kurkle--color.js'</span> <span class="c1"># @0.3.2</span>
</code></pre></div></div>

<p>Now, let’s create a Stimulus controller to use Chart.js. First, make sure you have Stimulus installed in your Rails application. Then, create a new file <code class="highlighter-rouge">app/javascript/controllers/chart_controller.js</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Controller</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@hotwired/stimulus</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Chart</span><span class="p">,</span> <span class="nx">registerables</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">chart.js</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">Chart</span><span class="p">.</span><span class="nf">register</span><span class="p">(...</span><span class="nx">registerables</span><span class="p">);</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nc">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="nx">targets</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">canvas</span><span class="dl">"</span><span class="p">];</span>

  <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasTarget</span><span class="p">.</span><span class="nf">getContext</span><span class="p">(</span><span class="dl">"</span><span class="s2">2d</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">chart</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Chart</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">line</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">labels</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">January</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">February</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">March</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">April</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">May</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">June</span><span class="dl">"</span><span class="p">],</span>
        <span class="na">datasets</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">label</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Sample Data</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">data</span><span class="p">:</span> <span class="p">[</span><span class="mi">65</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">55</span><span class="p">],</span>
            <span class="na">borderColor</span><span class="p">:</span> <span class="dl">"</span><span class="s2">rgba(75, 192, 192, 1)</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">backgroundColor</span><span class="p">:</span> <span class="dl">"</span><span class="s2">rgba(75, 192, 192, 0.2)</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">borderWidth</span><span class="p">:</span> <span class="mi">2</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">scales</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">y</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">beginAtZero</span><span class="p">:</span> <span class="kc">true</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nf">disconnect</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">chart</span><span class="p">.</span><span class="nf">destroy</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now you can use this Stimulus controller in your Rails view. For example, in <code class="highlighter-rouge">app/views/home/index.html.erb</code>:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">data-controller=</span><span class="s">"chart"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;canvas</span> <span class="na">data-chart-target=</span><span class="s">"canvas"</span> <span class="na">width=</span><span class="s">"400"</span> <span class="na">height=</span><span class="s">"200"</span><span class="nt">&gt;&lt;/canvas&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>This setup allows you to easily create charts in your Rails application using Chart.js through a Stimulus controller. The chart data can be dynamically passed from your Rails backend to the frontend using Stimulus values.</p>

<p>But if you try to load the page, the graph is not displayed. After looking at the developer tools in the browser, you will find the following error:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Failed to register controller: chart (controllers/chart_controller)
  TypeError: Importing a module script failed.
</code></pre></div></div>

<p>The error is not helpful, but it gives you a clue that there is a problem with the dependencies in the Stimulus <code class="highlighter-rouge">chart_controller</code>. Looking at the network tab in the browser tools, you find out that there is a missing file.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>URL: http://localhost:3000/_/6La3kzg5.js
Status: 404 Not Found
Source: Network
</code></pre></div></div>

<p>Looking at the code of the file <code class="highlighter-rouge">vendor/javascript/chart.js.js</code>, almost at the beginning of the file, you find the following reference:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span><span class="p">{</span><span class="nx">r</span> <span class="nx">as</span> <span class="nx">t</span><span class="p">,</span><span class="nx">c</span> <span class="p">...</span>
<span class="p">...</span> <span class="nx">as</span> <span class="nx">Jt</span><span class="p">}</span><span class="k">from</span><span class="dl">"</span><span class="s2">../_/6La3kzg5.js</span><span class="dl">"</span> <span class="p">...</span>
</code></pre></div></div>

<p>It seems like <a href="https://jspm.org">jspm.io</a> adds a dependency which Importmap is unable to identify and download with the rest of the files. This is a known issue documented in the Importmap repository, as <a href="https://github.com/rails/importmap-rails/pull/235">Download all the files associated with a package from a CDN</a>.</p>

<h3 id="3-pinning-from-cdns">3. Pinning from CDNs</h3>

<p>While Importmap pins libraries locally by default, it also allows you to pin from a CDN instead. Using this method, the library is served directly from the CDN instead of our Rails application.</p>

<p>To try to find a solution, change the pins in the <code class="highlighter-rouge">config/importmap.rb</code> file to point to the CDN:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Using JSPM.io (default)</span>
<span class="n">pin</span> <span class="s1">'chart.js'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'https://ga.jspm.io/npm:chart.js@4.3.0/dist/chart.js'</span>
<span class="n">pin</span> <span class="s1">'@kurkle/color'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'https://ga.jspm.io/npm:@kurkle/color@0.3.2/dist/color.esm.js'</span>
</code></pre></div></div>

<p>After making the change, reload the page. Now the graph is there, loading the libraries from the CDN solved the issue of missing references. If you are ok with this approach, then you can stop here.</p>

<p>If your goal is to serve and cache the libraries without a dependency on external CDN, then continue to the next section.</p>

<h3 id="4-customizing-local-pinning">4. Customizing local pinning</h3>

<p>With the option to choose a CDN from which to vendor JavaScript libraries, you should try another CDN, like <a href="www.jsdelivr.com">JSDeliver</a>. Each CDN bundles dependencies differently, so you might get lucky trying another option.</p>

<p>Remove all files from <code class="highlighter-rouge">vendor/javascript</code> and remove the pins to Chart.js and @kurkle/color from <code class="highlighter-rouge">config/importmap.rb</code>. The Importmap’s pin command accepts option <code class="highlighter-rouge">-f</code> to specify a specific CDN different from JSpm.io.</p>

<p>The first try to pin Chart.js fails with an error.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> bin/importmap pin chart.js <span class="nt">-f</span> jsdelivr
Pinning <span class="s2">"chart.js"</span> to vendor/javascript/chart.js.js via download from https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.js
/.rbenv/versions/3.3.4/lib/ruby/3.3.0/net/http.rb:1603:in <span class="sb">`</span>initialize<span class="s1">': Failed to open TCP connection to cdn.jsdelivr.net:443 (execution expired) (Net::OpenTimeout)
</span></code></pre></div></div>

<p>For the second try, add the library @kurkle/color to the pin command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> bin/importmap pin chart.js @kurkle/color  <span class="nt">-f</span> jsdelivr
Pinning <span class="s2">"@kurkle/color"</span> to vendor/javascript/@kurkle/color.js via download from https://cdn.jsdelivr.net/npm/@kurkle/color@0.3.2/dist/color.esm.js
Pinning <span class="s2">"chart.js"</span> to vendor/javascript/chart.js.js via download from https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.js
</code></pre></div></div>

<p>This time it succeeded, the new files are placed in <code class="highlighter-rouge">vendor/javascript</code> and the file <code class="highlighter-rouge">config/importmap.rb</code> contains the pins. Reloading the page in your application shows that you have the same error as before, the missing file name is different but still the same result.</p>

<p>It is time to try something different. Remove the files from <code class="highlighter-rouge">vendor/javascript</code> one more time. Navigate to that directory and open your browser to <a href="https://www.jsdelivr.com/">https://www.jsdelivr.com/</a>. Search for Chart.js and from the code block copy the URL and download the library using curl. Also, search for @kurkle/color and download it.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> curl <span class="nt">-o</span> chart.js.js <span class="s1">'https://cdn.jsdelivr.net/npm/chart.js@4.4.3/+esm'</span>
<span class="o">&gt;</span> curl <span class="nt">-o</span> @kurkle--color.js <span class="s1">'https://cdn.jsdelivr.net/npm/@kurkle/color@0.3.2/+esm'</span>
</code></pre></div></div>

<p>Once again, reload your application page. One more time you will get an error in the browser developer tools, but this time the error is different. It says that @kurkle/color failed to be loaded.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Error] Failed to load resource: the server responded with a status of 404 (Not Found) http://localhost:3000/npm/@kurkle/color@0.3.2/+esm
[Error] Failed to register controller: chart (controllers/chart_controller) – TypeError: Importing a module script failed.
TypeError: Importing a module script failed.
 error
</code></pre></div></div>

<p>The reference to <code class="highlighter-rouge">npm/@kurkle/color@0.3.2/+esm</code> appears at the beginning of chart.js.js file. You need to replace this reference for the @kurkle/color that you have pinned in <code class="highlighter-rouge">config/importmap.rb</code>. Use <code class="highlighter-rouge">sed</code> command to replace the value as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">''</span> <span class="s1">'s|/npm/@kurkle/color@0.3.2/+esm|@kurkle/color|g'</span> chart.js.js
</code></pre></div></div>

<p>After this change, reload the application page. Now the graph is rendered and there are no errors related to missing references.</p>

<p>Not in all cases when pinning libraries from a CDN you will have this problem, but if there is a case, now you know how to diagnose and try to fix it. I would expect that newer versions of Importmap will have a feature to understand and resolve hidden references that libraries might have.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Importmap in Ruby on Rails offers a streamlined approach to managing JavaScript libraries like Chart.js. By simplifying your workflow, leveraging the power of modern browsers, and providing local access to your dependencies, you can focus more on creating functionality and less on configuration. Give Importmap a try in your next Rails project and experience the benefits for yourself!</p>

<p>Remember, while Importmap is powerful and the default local pinning provides good version control, you still have the flexibility to use various CDNs when needed. Consider your specific needs and performance requirements when deciding on your Importmap strategy.</p>

                </div>
              </article>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>


      <!-- Footer -->
<footer class="mt-32 flex-none">
  <div class="sm:px-8">
    <div class="mx-auto w-full max-w-7xl lg:px-8">
      <div class="border-t border-zinc-100 pb-16 pt-10 dark:border-zinc-700/40">
        <div class="relative px-4 sm:px-8 lg:px-12">
          <div class="mx-auto max-w-2xl lg:max-w-5xl">
            <div class="flex flex-col items-center justify-between gap-6 sm:flex-row">
              <div
                class="
                  flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800
                  dark:text-zinc-200
                "
              >
              
                <a
                    href="/about"
                  class="
                    transition hover:text-emerald-500
                    dark:hover:text-emerald-400
                  "
                >
                About
                </a>
              
                <a
                    href="/articles"
                  class="
                    transition hover:text-emerald-500
                    dark:hover:text-emerald-400
                  "
                >
                Articles
                </a>
              
                <a
                    href="/projects"
                  class="
                    transition hover:text-emerald-500
                    dark:hover:text-emerald-400
                  "
                >
                Projects
                </a>
              
              </div>

              <p class="text-sm text-zinc-400 dark:text-zinc-500">
              &copy; 2025 Mario Alberto Chávez. All rights reserved.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

    </div>
  </body>
</html>
